# 新闻搜索服务数据库模型文档

## 数据库概述

本文档描述了新闻搜索服务所使用的数据库表结构及其关系。系统基于 Oracle 数据库，主要用于存储新闻文章内容及相关元数据。

## 表结构设计

### 基础信息表 (com_basicinfo)

存储文章的基本信息和元数据。

| 字段名 | 数据类型 | 说明 | 约束 |
| ----- | ------- | --- | --- |
| ID | VARCHAR2(32) | 唯一标识符 | 主键 |
| NAME | VARCHAR2(200) | 文章标题 | 非空 |
| CREATED | TIMESTAMP | 创建时间 | 非空 |
| LAST_UPDATED | TIMESTAMP | 最后更新时间 | - |
| STATUS | NUMBER(1) | 状态：0-无效，1-有效 | 非空，默认1 |
| SORT_NO | NUMBER(10) | 排序号 | - |

### 内容表 (cob_program)

存储文章的详细内容。

| 字段名 | 数据类型 | 说明 | 约束 |
| ----- | ------- | --- | --- |
| OBJECTID | VARCHAR2(32) | 对应基础信息表的ID | 外键，非空 |
| FIELD1079 | CLOB | 文章XML内容 | - |
| CREATE_TIME | TIMESTAMP | 创建时间 | 非空 |
| UPDATE_TIME | TIMESTAMP | 更新时间 | - |

## 表关系

![数据库表关系](../images/db_relation.png)

- **com_basicinfo** 与 **cob_program** 之间存在一对一关系
- 关联字段：com_basicinfo.ID = cob_program.OBJECTID

## 索引设计

为提高检索性能，系统在以下字段上建立了索引：

1. **com_basicinfo 表索引**：
   - PK_COM_BASICINFO（主键索引，ID字段）
   - IDX_COM_BASICINFO_NAME（NAME字段索引，用于标题搜索）
   - IDX_COM_BASICINFO_CREATED（CREATED字段索引，用于时间排序）

2. **cob_program 表索引**：
   - FK_COB_PROGRAM_OBJECTID（外键索引，OBJECTID字段）
   - IDX_COB_PROGRAM_CONTENT（FIELD1079字段文本索引，用于全文检索）

## 查询示例

### 基本联合查询

```sql
SELECT b.ID, b.NAME, p.FIELD1079 as xml_content, b.CREATED 
FROM cob_program p 
JOIN com_basicinfo b ON p.objectid = b.id 
WHERE b.STATUS = 1
ORDER BY b.CREATED DESC;
```

### 关键词搜索查询

```sql
SELECT b.ID, b.NAME, p.FIELD1079 as xml_content, b.CREATED 
FROM cob_program p 
JOIN com_basicinfo b ON p.objectid = b.id 
WHERE (UPPER(b.NAME) LIKE UPPER('%关键词%') OR UPPER(p.FIELD1079) LIKE UPPER('%关键词%'))
AND b.STATUS = 1
ORDER BY b.CREATED DESC;
```

## 数据维护建议

1. **数据备份**：建议每日凌晨对数据库进行全量备份，每小时进行增量备份
2. **性能优化**：
   - 定期重建索引，特别是全文检索索引
   - 对大表进行分区管理，按时间范围分区
   - 建议对 CLOB 类型的 FIELD1079 字段进行压缩存储
3. **容量规划**：
   - 预估每篇文章平均大小约为 50KB
   - 预留 30% 的额外存储空间应对峰值
   - 根据业务增长预测，每年约增加 500GB 存储需求

## 数据迁移策略

如需进行数据迁移，建议采用以下步骤：

1. 使用 Oracle Data Pump 导出源数据库中的表结构和数据
2. 在目标数据库中导入表结构
3. 分批次导入数据，优先导入基础信息表，再导入内容表
4. 验证数据一致性和完整性
5. 重建索引和统计信息